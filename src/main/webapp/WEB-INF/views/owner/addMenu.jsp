<%--
  Created by IntelliJ IDEA.
  User: fzaca
  Date: 25. 6. 19.
  Time: Ïò§ÌõÑ 4:29
  To change this template use File | Settings | File Templates.
--%><%--
  Created by IntelliJ IDEA.
  User: fzaca
  Date: 25. 6. 19.
  Time: Ïò§Ï†Ñ 9:19
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sol Food - Î†àÏä§ÌÜ†Îûë Í¥ÄÎ¶¨</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Ïπ¥Ïπ¥Ïò§Îßµ API -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8f9034d6cf1da650e02b54751e02fcb3&libraries=services"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9fa;
      color: #333;
    }

    .dashboard {
      display: flex;
      height: 100vh;
    }

    /* ÏÇ¨Ïù¥ÎìúÎ∞î */
    .sidebar {
      width: 250px;
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      color: white;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .sidebar-header p {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .sidebar-menu {
      list-style: none;
      padding: 20px 0;
    }

    .sidebar-menu li {
      margin: 5px 0;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .sidebar-menu a:hover {
      background: rgba(255,255,255,0.1);
      border-left: 3px solid white;
    }

    .sidebar-menu a.active {
      background: rgba(255,255,255,0.2);
      border-left: 3px solid white;
    }

    .sidebar-menu a .icon {
      margin-right: 12px;
      font-size: 1.2rem;
    }

    /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
    .main-content {
      flex: 1;
      margin-left: 250px;
      display: flex;
      flex-direction: column;
    }

    /* Ìó§Îçî */
    .header {
      background: white;
      padding: 15px 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 999;
    }

    .header-title {
      font-size: 1.8rem;
      font-weight: 600;
      color: #333;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4ade80, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .user-details h4 {
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .user-details p {
      font-size: 0.8rem;
      color: #666;
    }

    .logout-btn {
      background: #ef4444;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }

    .logout-btn:hover {
      background: #dc2626;
    }

    /* ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
    .content {
      flex: 1;
      padding: 30px 60px;
      overflow-y: auto;
    }

    .content-header {
      margin-bottom: 30px;
    }

    .content-header h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .content-header p {
      color: #666;
      font-size: 1rem;
    }

    /* ÏÉÅÏ†ê Í¥ÄÎ¶¨ ÏòÅÏó≠ */
    .menu-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .filter-tabs {
      display: flex;
      gap: 10px;
    }

    .tab-btn {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .tab-btn.active {
      background: #22c55e;
      color: white;
      border-color: #22c55e;
    }

    .add-menu-btn {
      background: #22c55e;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.3s ease;
    }

    .add-menu-btn:hover {
      background: #16a34a;
    }

    /* ÏÉÅÏ†ê Í∑∏Î¶¨Îìú */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .menu-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .menu-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .menu-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .menu-info {
      padding: 20px;
    }

    .menu-name {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .menu-description {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .menu-price {
      font-size: 1.3rem;
      font-weight: 700;
      color: #22c55e;
      margin-bottom: 15px;
    }

    .menu-actions-card {
      display: flex;
      gap: 10px;
    }

    .edit-btn, .delete-btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .edit-btn {
      background: #3b82f6;
      color: white;
    }

    .edit-btn:hover {
      background: #2563eb;
    }

    .delete-btn {
      background: #ef4444;
      color: white;
    }

    .delete-btn:hover {
      background: #dc2626;
    }

    /* Î™®Îã¨ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modified-content {
    }

    .modal-header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .modal-header h3 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.address input{
      width: inherit;
      margin-bottom:8px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #22c55e;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn-cancel, .btn-save {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .btn-cancel {
      background: #6b7280;
      color: white;
    }

    .btn-cancel:hover {
      background: #4b5563;
    }

    .btn-save {
      background: #22c55e;
      color: white;
    }

    .btn-save:hover {
      background: #16a34a;
    }

    .breadcrumb{display: block; color: #666; }

    #preview {padding: 10px; border-radius: 6px; border:1px solid #ddd; display: none }
    #preview img{width: 100%}

  </style>
</head>
<body>
<div class="dashboard">
  <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h2>üçΩÔ∏è <c:out value="${restaurantName}" default="Sol Food"/></h2>
      <p>Î†àÏä§ÌÜ†Îûë Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</p>
    </div>
    <ul class="sidebar-menu">
      <li>
        <a href="#" data-tab="store" data-tab="overview" class="active" >
          <span class="icon">üìÖ</span>
          <span>ÏÉÅÏ†ê Í¥ÄÎ¶¨</span>
        </a>
      </li>
      <li>
        <a href="<c:url value="/owner/menu" />" data-tab="menu">
          <span class="icon">üçΩÔ∏è</span>
          <span>Î©îÎâ¥ Í¥ÄÎ¶¨</span>
        </a>
      </li>
      <li>
        <a href="#" >
          <span class="icon">üìä</span>
          <span>Îß§Ï∂ú Í¥ÄÎ¶¨</span>
        </a>
      </li>
      <li>
        <a href="#" data-tab="testimonials">
          <span class="icon">üí¨</span>
          <span>Î¶¨Î∑∞ Í¥ÄÎ¶¨</span>
        </a>
      </li>
      <li>
        <a href="#" data-tab="faq">
          <span class="icon">‚ùì</span>
          <span>FAQ</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
  <main class="main-content">
    <!-- Ìó§Îçî -->
    <header class="header">
      <h1 class="header-title"></h1>
      <div class="header-actions">
        <div class="user-info">
          <div class="user-avatar">Í¥Ä</div>
          <div class="user-details">
            <h4>${ownerLoginSession.ownerEmail}</h4>
            <p>Î†àÏä§ÌÜ†Îûë Ïò§ÎÑà</p>
          </div>
        </div>
        <button class="logout-btn" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
      </div>
    </header>

    <!-- ÏΩòÌÖêÏ∏† ÏòÅÏó≠ -->
    <section class="content">
      <div class="content-header">
        <span class="breadcrumb">üè† ÏÉÅÏ†ê Í¥ÄÎ¶¨</span>
        <h1>ÏÉÅÏ†ê Í¥ÄÎ¶¨</h1>
        <p>ÏÉÅÏ†ê Ï†ïÎ≥¥Î•º Îì±Î°ùÌïòÍ±∞ÎÇò ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§ </p>
      </div>

      <div class="menu-actions">
        <div class="filter-tabs">
        </div>
        <button class="add-menu-btn" onclick="openAddModal()">
          <span>‚ûï</span>
          ÏÉÅÏ†ê Îì±Î°ù
        </button>

      </div>

      <div class="menu-content">
        <!-- Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïòÎèÑÎ°ù ÎßåÎì≠ÎãàÎã§. -->
        <div class="menu-grid" id="menuGrid">
          <c:if test="${store != null}">
            <div class="menu-card">
              <img src="${store.storeMainimage}" class="menu-image" onerror="this.src='https://via.placeholder.com/300x200/22c55e/ffffff?text=%EB%B6%88%EA%B3%A0%EA%B8%B0%20%EC%A0%95%EC%8B%9D'">
              <div class="menu-info">
                <div class="menu-name">ÏÉÅÏ†êÎ™Ö : ${store.storeName}</div>
                <div class="menu-description">ÏÉÅÏ†ê ÏÜåÍ∞ú : ${store.storeIntro}</div>
              </div>
            </div>
          </c:if>
        </div>
      </div>
    </section>
  </main>

</div>

<!-- ÏÉÅÏ†ê Ï∂îÍ∞Ä/ÏàòÏ†ï Î™®Îã¨ -->
<div class="modal" id="storeModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">ÏÉÅÏ†ê Îì±Î°ù</h3>
      <p>ÏÉÅÏ†ê Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</p>
    </div>
    <form id="storeForm" enctype="multipart/form-data">
      <div class="form-group">
        <label for="storeName">ÏÉÅÏ†êÎ™Ö</label>
        <input type="text" id="storeName" name="storeName" required>
      </div>

      <div class="form-group">
        <label for="categoryId">ÏÉÅÏ†ê Ïπ¥ÌÖåÍ≥†Î¶¨</label>
        <select id="categoryId" name="categoryId" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
          <option value="1">--Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù--</option>
          <c:forEach var="c" items="${categoryList}">
            <option value="${c.categoryId}">${c.categoryName}</option>
          </c:forEach>
        </select>
      </div>

      <div class="form-group address">
        <label for="storeAddress">ÏÉÅÏ†ê ÏúÑÏπò</label>
        <div class="test">
          <input type="text" id="sample3_postcode" placeholder="Ïö∞Ìé∏Î≤àÌò∏">
          <input type="button" onclick="sample3_execDaumPostcode()" value="Ïö∞Ìé∏Î≤àÌò∏ Ï∞æÍ∏∞" class="btn-cancel" style="padding: 9px"><br>
          <input type="text" id="sample3_address" placeholder="Ï£ºÏÜå" style="width: 100%"><br>
          <input type="text" id="sample3_detailAddress" style="width: 100%" placeholder="ÏÉÅÏÑ∏Ï£ºÏÜå">
          <input type="text" id="sample3_extraAddress" style="width: 100%" placeholder="Ï∞∏Í≥†Ìï≠Î™©">

          <div id="wrap" style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
            <img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="Ï†ëÍ∏∞ Î≤ÑÌäº">
          </div>
        </div>
      </div>
      <input type="hidden" id="storeAddress" name="storeAddress">

      <div class="form-group">
        <label for="storeTel">ÏÉÅÏ†ê Î≤àÌò∏</label>
        <input type="text" id="storeTel" name="storeTel" required>
      </div>
      <div class="form-group">
        <label for="storeIntro">ÏÉÅÏ†ê ÏÜåÍ∞ú</label>
        <input type="text" id="storeIntro" name="storeIntro" required>
      </div>
      <div class="form-group">
        <!-- ÌååÏùº ÏÑ†ÌÉù Î≤ÑÌäº (label) -->
        <input type="hidden" name="storeMainimage" value="null">
        <%--        <label for="storeMainimage" class="btn-cancel" style="display: inline-block; color: #fff; font-weight: 400">ÌååÏùº ÏÑ†ÌÉù</label>--%>
        <%--        <input class="btn-cancel" accept="image/*" type="file" id="storeMainimage" name="storeMainimage" onchange="previewStoreMainimage(event)" style="display: none">--%>
      </div>
      <div id="preview">
        <img id="storeImagePreview" src="" alt="">
        <button type="button" class="btn-cancel" id="deleteImageBtn" onclick="deleteImagePreview()" style="display:none; margin-top: 10px;">Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú</button>
      </div>
      <%--ÏúÑÎèÑ--%>
      <input type="hidden" name="storeLatitude" id="storeLatitude" >
      <%--Í≤ΩÎèÑ--%>
      <input type="hidden" name="storeLongitude" id="storeLongitude" >
      <div class="modal-actions">
        <button type="button" class="btn-cancel" onclick="closeModal()">Ï∑®ÏÜå</button>
        <button type="submit" class="btn-save">Ï†ÄÏû•</button>
      </div>
    </form>
  </div>
</div>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
  function logout(){
    if(confirm("Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?üòä")){
      window.location.href="/solfood/owner/logout";
    }
  }
  let editingMenuId = null;

  $(document).ready(function () {
    setupEventListeners();
  });

  // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
  function setupEventListeners() {
    // ÏÉÅÏ†ê Ìèº Ï†úÏ∂ú
    $('#storeForm').on('submit', function (e) {
      e.preventDefault();
      saveStore();
    });

    // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
    // $(window).on('click', function (e) {
    //   if ($(e.target).is('#storeModal')) {
    //     closeModal();
    //   }
    // });
  }

  // ÏÉÅÏ†ê Îì±Î°ù Î™®Îã¨ Ïó¥Í∏∞
  function openAddModal() {
    editingMenuId = null;
    $('#modalTitle').text('ÏÉÅÏ†ê Îì±Î°ù');
    $('#storeForm')[0].reset();
    $('#storeModal').show();
  }

  // ÏÉÅÏ†ê Ï†ÄÏû•
  function saveStore() {
    const form = document.getElementById('storeForm');
    const formData = new FormData(form);

    fetch("/solfood/owner/store",{
      method:"POST",
      body:formData // ÌèºÎç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°Ïãú content-type ÏÉùÎûµÌï¥ÏïºÌï®
    })
            .then(response => {
              if (!response.ok) throw new Error("ÏÑúÎ≤Ñ ÏùëÎãµ Ïã§Ìå®");
              return response.json(); // ÏÑúÎ≤ÑÏóêÏÑú storeÏ†ïÎ≥¥Î•º Î∞õÏïÑÏò¥
            })
            .then(store  => {
              if(!store){
                alert("ÏÉÅÏ†ê Îì±Î°ù Ïã§Ìå®");
                return;
              }
              alert("ÏÉÅÏ†ê Îì±Î°ù ÏÑ±Í≥µ");
              closeModal();
              // Î∞îÎ°ú ÏÉÅÏ†ê Ï†ïÎ≥¥Î•º DOMÏóê Ï∂îÍ∞Ä
              renderStoreCard(store);
            })
            .catch(error => {
              alert("ÏÉÅÏ†ê Îì±Î°ù Ïã§Ìå®: " + error);
              console.error("ÏóêÎü¨:", error);
            });
  }

  function renderStoreCard(store){
    document.querySelector(".add-menu-btn").style.display = "none";
    const grid = document.getElementById("menuGrid") || document.createElement("div");
    grid.setAttribute("id","menuGrid");
    grid.classList.add("menu-grid");

    grid.innerHTML = `
    <div class="menu-card">
      <img src="${store.storeMainimage}" class="menu-image"
           onerror="this.src='https://via.placeholder.com/300x200/22c55e/ffffff?text=No+Image'">
      <div class="menu-info">
        <div class="menu-name">ÏÉÅÏ†êÎ™Ö : ${store.storeName}</div>
        <div class="menu-description">ÏÉÅÏ†ê ÏÜåÍ∞ú : ${store.storeIntro}</div>
      </div>
    </div>
  `;


    // DOMÏóê ÏÇΩÏûÖ
    document.querySelector(".menu-content").appendChild(grid);
  }

  // Î™®Îã¨ Îã´Í∏∞
  function closeModal() {
    $('#storeModal').hide();
    editingMenuId = null;
  }

  // --------------------------------ÏúÑÏπò Ï∞æÍ∏∞---------------------------------
  // Ïö∞Ìé∏Î≤àÌò∏ Ï∞æÍ∏∞ Ï∞æÍ∏∞ ÌôîÎ©¥ÏùÑ ÎÑ£ÏùÑ element
  var element_wrap = document.getElementById('wrap');

  function foldDaumPostcode() {
    // iframeÏùÑ ÎÑ£ÏùÄ elementÎ•º ÏïàÎ≥¥Ïù¥Í≤å ÌïúÎã§.
    element_wrap.style.display = 'none';
  }

  function sample3_execDaumPostcode() {
    // ÌòÑÏû¨ scroll ÏúÑÏπòÎ•º Ï†ÄÏû•Ìï¥ÎÜìÎäîÎã§.
    var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
    new daum.Postcode({
      oncomplete: function(data) {
        // Í≤ÄÏÉâÍ≤∞Í≥º Ìï≠Î™©ÏùÑ ÌÅ¥Î¶≠ÌñàÏùÑÎïå Ïã§ÌñâÌï† ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎäî Î∂ÄÎ∂Ñ.

        // Í∞Å Ï£ºÏÜåÏùò ÎÖ∏Ï∂ú Í∑úÏπôÏóê Îî∞Îùº Ï£ºÏÜåÎ•º Ï°∞Ìï©ÌïúÎã§.
        // ÎÇ¥Î†§Ïò§Îäî Î≥ÄÏàòÍ∞Ä Í∞íÏù¥ ÏóÜÎäî Í≤ΩÏö∞Ïóî Í≥µÎ∞±('')Í∞íÏùÑ Í∞ÄÏßÄÎØÄÎ°ú, Ïù¥Î•º Ï∞∏Í≥†ÌïòÏó¨ Î∂ÑÍ∏∞ ÌïúÎã§.
        var addr = ''; // Ï£ºÏÜå Î≥ÄÏàò
        var extraAddr = ''; // Ï∞∏Í≥†Ìï≠Î™© Î≥ÄÏàò

        //ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÑ†ÌÉùÌïú Ï£ºÏÜå ÌÉÄÏûÖÏóê Îî∞Îùº Ìï¥Îãπ Ï£ºÏÜå Í∞íÏùÑ Í∞ÄÏ†∏Ïò®Îã§.
        if (data.userSelectedType === 'R') { // ÏÇ¨Ïö©ÏûêÍ∞Ä ÎèÑÎ°úÎ™Ö Ï£ºÏÜåÎ•º ÏÑ†ÌÉùÌñàÏùÑ Í≤ΩÏö∞
          addr = data.roadAddress;
        } else { // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏßÄÎ≤à Ï£ºÏÜåÎ•º ÏÑ†ÌÉùÌñàÏùÑ Í≤ΩÏö∞(J)
          addr = data.jibunAddress;
        }

        // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÑ†ÌÉùÌïú Ï£ºÏÜåÍ∞Ä ÎèÑÎ°úÎ™Ö ÌÉÄÏûÖÏùºÎïå Ï∞∏Í≥†Ìï≠Î™©ÏùÑ Ï°∞Ìï©ÌïúÎã§.
        if(data.userSelectedType === 'R'){
          // Î≤ïÏ†ïÎèôÎ™ÖÏù¥ ÏûàÏùÑ Í≤ΩÏö∞ Ï∂îÍ∞ÄÌïúÎã§. (Î≤ïÏ†ïÎ¶¨Îäî Ï†úÏô∏)
          // Î≤ïÏ†ïÎèôÏùò Í≤ΩÏö∞ ÎßàÏßÄÎßâ Î¨∏ÏûêÍ∞Ä "Îèô/Î°ú/Í∞Ä"Î°ú ÎÅùÎÇúÎã§.
          if(data.bname !== '' && /[Îèô|Î°ú|Í∞Ä]$/g.test(data.bname)){
            extraAddr += data.bname;
          }
          // Í±¥Î¨ºÎ™ÖÏù¥ ÏûàÍ≥†, Í≥µÎèôÏ£ºÌÉùÏùº Í≤ΩÏö∞ Ï∂îÍ∞ÄÌïúÎã§.
          if(data.buildingName !== '' && data.apartment === 'Y'){
            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
          }
          // ÌëúÏãúÌï† Ï∞∏Í≥†Ìï≠Î™©Ïù¥ ÏûàÏùÑ Í≤ΩÏö∞, Í¥ÑÌò∏ÍπåÏßÄ Ï∂îÍ∞ÄÌïú ÏµúÏ¢Ö Î¨∏ÏûêÏó¥ÏùÑ ÎßåÎì†Îã§.
          if(extraAddr !== ''){
            extraAddr = ' (' + extraAddr + ')';
          }
          // Ï°∞Ìï©Îêú Ï∞∏Í≥†Ìï≠Î™©ÏùÑ Ìï¥Îãπ ÌïÑÎìúÏóê ÎÑ£ÎäîÎã§.
          document.getElementById("sample3_extraAddress").value = extraAddr;

        } else {
          document.getElementById("sample3_extraAddress").value = '';
        }

        // Ïö∞Ìé∏Î≤àÌò∏ÏôÄ Ï£ºÏÜå Ï†ïÎ≥¥Î•º Ìï¥Îãπ ÌïÑÎìúÏóê ÎÑ£ÎäîÎã§.
        document.getElementById('sample3_postcode').value = data.zonecode;
        document.getElementById("sample3_address").value = addr;
        // Ïª§ÏÑúÎ•º ÏÉÅÏÑ∏Ï£ºÏÜå ÌïÑÎìúÎ°ú Ïù¥ÎèôÌïúÎã§.
        document.getElementById("sample3_detailAddress").focus();

        // iframeÏùÑ ÎÑ£ÏùÄ elementÎ•º ÏïàÎ≥¥Ïù¥Í≤å ÌïúÎã§.
        // (autoClose:false Í∏∞Îä•ÏùÑ Ïù¥Ïö©ÌïúÎã§Î©¥, ÏïÑÎûò ÏΩîÎìúÎ•º Ï†úÍ±∞Ìï¥Ïïº ÌôîÎ©¥ÏóêÏÑú ÏÇ¨ÎùºÏßÄÏßÄ ÏïäÎäîÎã§.)
        element_wrap.style.display = 'none';

        // Ïö∞Ìé∏Î≤àÌò∏ Ï∞æÍ∏∞ ÌôîÎ©¥Ïù¥ Î≥¥Ïù¥Í∏∞ Ïù¥Ï†ÑÏúºÎ°ú scroll ÏúÑÏπòÎ•º ÎêòÎèåÎ¶∞Îã§.
        document.body.scrollTop = currentScroll;

        // ----------------------Ï∂îÍ∞Ä --------------------
        const fullAddress = addr + document.getElementById("sample3_detailAddress").value+' ' + (extraAddr || '');
        document.getElementById("storeAddress").value = fullAddress;

        getLatLngFromAddress(fullAddress);
      },
      // Ïö∞Ìé∏Î≤àÌò∏ Ï∞æÍ∏∞ ÌôîÎ©¥ ÌÅ¨Í∏∞Í∞Ä Ï°∞Ï†ïÎêòÏóàÏùÑÎïå Ïã§ÌñâÌï† ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎäî Î∂ÄÎ∂Ñ. iframeÏùÑ ÎÑ£ÏùÄ elementÏùò ÎÜíÏù¥Í∞íÏùÑ Ï°∞Ï†ïÌïúÎã§.
      onresize : function(size) {
        element_wrap.style.height = size.height+'px';
      },
      width : '100%',
      height : '100%'
    }).embed(element_wrap);

    // iframeÏùÑ ÎÑ£ÏùÄ elementÎ•º Î≥¥Ïù¥Í≤å ÌïúÎã§.
    element_wrap.style.display = 'block';
  }

  document.getElementById("sample3_detailAddress").addEventListener("blur",function (){
    const addr = document.getElementById("sample3_address").value;
    const detail = this.value;
    const extra = document.getElementById("sample3_extraAddress").value;

    document.getElementById("storeAddress").value = addr + ' ' + detail + ' ' + extra;
  })

  // ---------------------------- ÎåÄÌëúÏù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ -------------------------------------
  async function previewStoreMainimage(event){

    let files = event.target.files; // ÌååÏùº ÏÑ†ÌÉù input ÏóêÏÑú ÏÑ†ÌÉùÎêú ÌååÏùº Î¶¨Ïä§Ìä∏ Í∞ÄÏ†∏Ïò§Í∏∞
    let reader = new FileReader(); // ÌååÏùºÏùÑ ÏùΩÍ∏∞ ÏúÑÌïú fileReader Í∞ùÏ≤¥ ÏÉùÏÑ±
    reader.onload = function (e){ // ÌååÏùº ÏùΩÍ∏∞Í∞Ä ÏôÑÎ£å ÎêêÏùÑ Îïå Ïã§ÌñâÌï† Ìï®Ïàò Ï†ïÏùò
      let img = document.getElementById("storeImagePreview"); // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌÉúÍ∑∏
      img.setAttribute('src',e.target.result); // src ÏÜçÏÑ± ÏÑ§Ï†ï

      document.getElementById("preview").style.display = "block";
      document.getElementById("deleteImageBtn").style.display = "block"; // ÏÇ≠Ï†úÎ≤ÑÌäº ÌëúÏãú
    }

    const file = files[0]; // ‚úÖ Ïù¥ Ï§ÑÏù¥ Íº≠ ÌïÑÏöîÌï©ÎãàÎã§!

    reader.readAsDataURL(files[0]); // Ï≤´Î≤àÏß∏ ÌååÏùºÏùÑ Ïù∏ÏΩîÎî©ÏúºÎ°ú ÏùΩÍ∏∞
  }

  // -----------------------------ÎåÄÌëúÏù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú----------------------------------
  function deleteImagePreview(){
    document.getElementById("preview").style.display = "none";
    document.getElementById("storeImagePreview").src = ""; // ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†úÍ±∞
    document.getElementById("storeMainimage").value = ""; // ÌååÏùº input Ï¥àÍ∏∞Ìôî
    document.getElementById("deleteImageBtn").style.display = "none"; // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌÉúÍ∑∏
  }

  // ----------------------------ÏúÑÎèÑ Í≤ΩÎèÑ ---------------------------------------
  function getLatLngFromAddress(fullAddress){
    var geocoder = new kakao.maps.services.Geocoder();

    var callback = function(result, status) {
      if (status === kakao.maps.services.Status.OK) {
        console.log(result);
        const lat = result[0].y; // ÏúÑÎèÑ
        const lng = result[0].x; // Í≤ΩÎèÑ
        document.getElementById("storeLatitude").value = lat;
        document.getElementById("storeLongitude").value = lng;
      } else{
        alert("ÏúÑÎèÑ Í≤ΩÎèÑ Ï°∞Ìöå Ïã§Ìå®",status)
      }
    };

    geocoder.addressSearch(fullAddress, callback);
  }
</script>
</body>
</html>
